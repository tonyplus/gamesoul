!function(g,a){window.Mirs=window.Mirs||{};window.Mirs.ScriptManager=window.Mirs.ScriptManager||{};if(window.Mirs.ScriptManager.JSManager){throw new Error("Mirs.ScriptManager.JSManager 类重复加载")}var jsManager=window.Mirs.ScriptManager.JSManager=function(){this._jsInfoList=new Array();this._loadList=new Array();this._errorList=new Array();this._modelList=new Array();this._itemModelList=new Array();this._callbackComplete=null;this._loadCount=0};var _jsManager=null;jsManager.getInstance=function(){var rtn=null;if(_jsManager==null){rtn=new window.Mirs.ScriptManager.JSManager();_jsManager=rtn}else{rtn=_jsManager}return rtn};jsManager.Create=function(){var rtn=new window.Mirs.ScriptManager.JSManager();rtn.GetLoadList=g.cd(rtn,rtn.GetLoadList);rtn.GetModelList=g.cd(rtn,rtn.GetModelList);rtn.GetItemModelList=g.cd(rtn,rtn.GetItemModelList);rtn.GetLoadCount=g.cd(rtn,rtn.GetLoadCount);rtn.SetLoadCount=g.cd(rtn,rtn.SetLoadCount);rtn.addItem=g.cd(rtn,rtn.addItem);rtn.addItemModel=g.cd(rtn,rtn.addItemModel);rtn.platLoaded=g.cd(rtn,rtn.platLoaded);_jsManager=rtn;return rtn};jsManager.prototype.SetLoadCount=function(c){this._loadCount=c;return this._loadCount};jsManager.prototype.GetLoadCount=function(){return this._loadCount};jsManager.prototype.GetLoadList=function(){return this._loadList};jsManager.prototype.GetModelList=function(){return this._modelList};jsManager.prototype.GetItemModelList=function(){return this._itemModelList};jsManager.prototype.GetCallbackComplete=function(){return this._callbackComplete};jsManager.prototype.starup=function(){if(this._itemModelList.length==0){var callfunc=this.GetCallbackComplete();callfunc()}for(var i=0;i<this._itemModelList.length;i++){var tempModel=this._itemModelList[i];this.addItem(tempModel)}};jsManager.prototype.addItemModel=function(model){this._itemModelList.push(model)};jsManager.prototype.platLoaded=function(){for(var i=0;i<this._modelList.length;i++){var model=this._modelList[i];if(model.mirsCompleted){model.mirsCompleted(model)}}};jsManager.prototype.addItem=function(model){var isLoad=true;for(var i=0;i<this._jsInfoList.length;i++){var temp=this._jsInfoList[i];if(temp._cfgModel._RunUrl==model._cfgModel._RunUrl){isLoad=false;break}}if(isLoad){this._jsInfoList.push(model);addJs(model)}else{createCustomFunc(model)}};var jsManagerItem=window.Mirs.ScriptManager.JSManagerItem=function(){this._cfgModel=null;this._subElement=null;this._rtnFunc=null};var addJs=function(model){var stemp=window.Mirs.ScriptManager.JSManager.getInstance();var _doc=document.getElementsByTagName("head")[0];var oScript=document.createElement("script");oScript.type="text/javascript";var rUrl=model._cfgModel._RunUrl;if(rUrl.indexOf("http://")>=0){rUrl=model._cfgModel._RunUrl}else{if(rUrl.substring(0,1)=="/"){}else{var curWwwPath=window.document.location.href;var pathName=window.document.location.pathname;var pos=curWwwPath.indexOf(pathName);var localhostPath=curWwwPath.substring(0,pos);var app=window.Mirs.Application.getInstance();if(localhostPath=="http://"){var ht=location.host;var pt=location.port==""?"":":"+location.port;localhostPath="http://"+ht+pt}rUrl=localhostPath+"/"+app.View.getMirsConfig().SiteUrl+"/"+rUrl}}var mRan=Math.round(Math.random()*100);oScript.src=rUrl+"?r="+mRan;oScript.jsModel=model;_doc.appendChild(oScript);oScript.onerror=function(){stemp._errorList.push(model);this.setAttribute("error","加载失败")};oScript.onload=function(){var isLoad=false;if(this.readyState!="loading"||this.readyState=="loaded"||this.readyState=="complete"){isLoad=true;stemp._loadList.push(model);createCustomFunc(model);oScript.onload=null}}};var createCustomFunc=function(model){var tempElement=model._subElement;var tempCfgModel=model._cfgModel;var tempRtnFunc=model._rtnFunc;var stemp=window.Mirs.ScriptManager.JSManager.getInstance();var loadCount=stemp.GetLoadCount();try{var cls=eval(tempCfgModel._RunClassName);var obj=new cls();loadCount=loadCount+1;if(obj.initParms){stemp._modelList.push(obj);obj.initParms(tempElement,modelPublic(model._cfgModel));if(tempRtnFunc){tempRtnFunc()}}}catch(e){loadCount=loadCount+1;alert(e+"js名称："+model._cfgModel._RunUrl+"中的函数："+tempCfgModel._RunClassName+"调用失败")}stemp.SetLoadCount(loadCount);if(loadCount==(stemp._itemModelList.length-stemp._errorList.length)){var callfunc=stemp.GetCallbackComplete();callfunc(stemp)}};var modelPublic=function(model){var rtn={};rtn.BackgroundColor=model._BackgroundColor;rtn.Caption=model._Caption;rtn.Code=model._Code;rtn.Description=model._Description;rtn.FontColor=model._FontColor;rtn.HelpUrl=model._HelpUrl;rtn.Icon=model._Icon;rtn.IconClassName=model._IconClassName;rtn.NavClassName=model._NavClassName;rtn.ParmsExpression=model._ParmsExpression;rtn.RunTarget=model._RunTarget;rtn.RunUrl=model._RunUrl;rtn.Tags=model._Tags;if(model._ScriptType==""){rtn.ScriptType=model._ScriptType;rtn.RunClassName=model._RunClassName}else{rtn.FuncType="URL"}return rtn}}(Mirs.Global,Mirs.Application);